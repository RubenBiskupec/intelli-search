World Electric

Z
Vehicle Journal (mpPt|

 

Article

Initial Rotor Position Detection for Permanent Magnet
Synchronous Motor Based on High-Frequency Voltage
Injection without Filter

Zhiqiang Wang !, Bo Yao 2, Liyan Guo 2, Xuefeng Jin !, Xinmin Li 7© and Huimin Wang ?”*

1 School of Artificial Intelligence, Tiangong University, Tianjin 300387, China;

wangzhigiang@tiangong.edu.cn (Z.W.); jinxuefeng@tiangong.edu.cn (X.]J.)

School of Electrical Engineering and Automation, Tiangong University, Tianjin 300387, China;
1831045303@tiangong.edu.cn (B.Y.); guoliyan@tju.edu.cn (L.G.); lixinmin@tju.edu.cn (X.L.)

* Correspondence: wanghuimin@tju.edu.cn; Tel.: +86-1350-207-6811

Received: 18 September 2020; Accepted: 6 November 2020; Published: 9 November 2020 G cnfatce

Abstract: The accurate initial rotor position of a permanent magnet synchronous motor (PMSM) is
necessary for starting the motor, and for the position sensorless control method adopted by a PMSM
control system under some working conditions. This paper presents a new method to detect the
initial rotor position of a permanent magnet synchronous motor (PMSM). The method does not
need a low-pass filter, and has strong robustness and a simple calculation method. According to the
relationship between high-frequency current response and rotor position angle 0, the rotor position
angle can be obtained by arctangent and linear formulae. Finally, the magnetic polarity of the rotor
is distinguished according to the change of inductance. In this method, the arctangent function is
used to eliminate the filtering process and reduce the influence of the parameter deviation of the
motor system on the detection accuracy of the initial position. The experimental results verify the
correctness of the theoretical analysis and the effectiveness of the method.

Keywords: permanent magnet synchronous motor; rotor position detection; high frequency voltage
injection; magnetic saturation

1. Introduction

The permanent magnet synchronous motor has the advantages of simple structure, low loss,
high power factor and high efficiency, so it has been widely used in the fields of industrial robots,
aerospace and other fields. In order to achieve high-performance control, it is necessary to accurately
detect the initial rotor position [1-9]. The running performance of the motor will be decreased and a
smooth start-up process will not be achieved unless the initial rotor position of the permanent magnet
synchronous motor is accurate. Therefore, the initial position of the rotor needs to be accurately
estimated in order to realize the high-performance control [1-9].

There are two kinds of calculation principle in the position sensorless control of a permanent magnet
synchronous motor (PMSM). The first one is based on the fundamental mathematical model of the PMSM
and the second is based on the salient characteristics of the motor. Among the above-mentioned methods,
the first method usually extracts the position signal from the back electromotive force (EMF), according
to the relationship between back EMF and rotor position. The EMF can be obtained directly from the
voltage equation. This method is very simple, but it needs accurate motor parameters [10]. However,
it is very difficult to calculate the back EMF based on the voltage equation because the back EMF
of the motor will be small when the speed drops to zero. Therefore, it is necessary to make use of
the salient polarity of the motor. In order to obtain significant salient polarity, the signal injection

World Electric Vehicle Journal 2020, 11, 71; doi:10.3390/wevj11040071 www.mdpi.com/journal/wevj
World Electric Vehicle Journal 2020, 11, 71 2 of 17

method is usually used to obtain the high-frequency response current, which contains the rotor position
information. The high-frequency signal injection method is based on the salient pole effect of the motor,
which can effectively estimate the initial rotor position of the permanent magnet synchronous motor.
According to the nature of the injection signal, it can be divided into a rotating high-frequency signal
injection method [11] and a high-frequency pulse signal injection method [12]; according to the position
of the injection signal of the whole motor control system, it can be divided into a high-frequency
voltage signal injection method [12-14] and a high-frequency current signal injection method [15].
Among these, the representative methods include a voltage pulse vector injection method [16,17]
and a high-frequency signal injection method [17,18]. In reference [19], a series of voltage pulses
with equal amplitude and different directions are applied to the motor, and the initial position of the
rotor is estimated by detecting and comparing the corresponding stator current, which is the basic
idea of the voltage pulse injection method. The theoretical error of this method is small, but it is
difficult to determine the pulse width and amplitude and to implement this approach, and the error
also affects the accuracy of position estimation. In reference [20], initial rotor position is estimated
from a spatial saliency tracking estimator. Magnet polarity is identified simultaneously by using
the fundamental harmonic of rotor position in the second harmonic frame of the carrier frequency
due to d and q-axis saturation saliencies for both rotating and pulsating voltage carrier injection.
However, this method uses a low-pass filter, and the algorithm is complex and difficult to implement.
In reference [21], the high-frequency square wave signal injection method is adopted. This method
does not need to use a filter to extract the high-frequency response current, which increases the
system bandwidth. However, the high-frequency square wave signal has the disadvantages of strong
sensitivity to the measurement error, and is easily affected by the sampling delay and the nonlinear
effect of the inverter. In reference [22], according to the characteristics of the phase induction of
Inner Permanent Magnet Synchronous Motors (IPMSMs), the corresponding relationship between the
rotor position and the phase inductance is obtained. In this method, the rotor position information
is obtained easily, with several basic math operations and logical comparisons of phase inductances,
without any coordinate transformation or trigonometric function calculation. However, the algorithm
is sensitive to disturbance and has poor robustness.

First of all, this paper studies the conventional high-frequency sinusoidal voltage injection
method [23,24]. The principle of this method is to inject a high-frequency sinusoidal voltage signal
into the x-B-axis, and then generate the high-frequency response current. Finally, the initial position
of the rotor is obtained by using the relationship between the amplitude of the high-frequency
response current and the position of the rotor. However, this method requires bandpass filters when
demodulating the amplitude of the high-frequency response current, and the use of the filters will delay
the rotor position and cause errors. When calculating the rotor position, the arcsine formula is used.
This method includes physical quantities such as inductance and injection voltage. These physical
quantities will affect the calculation results and make them inaccurate.

In this paper, aiming at the shortcomings of the traditional sinusoidal signal injection method to
detect the initial position of the rotor, anew method based on a high-frequency sinusoidal voltage
signal injection method is proposed. The advantages of the proposed method are as follows.

(1) There is no need to use a filter to extract the high-frequency response current.
(2) Itis less dependent on parameters.
(3) The method is simple and effective, and occupies fewer resources of the digital control system.

Theoretical analysis and experimental results show that the method can accurately detect the
rotor’s initial position, and verify the feasibility and effectiveness of the method proposed in this paper.
This paper discusses the effectiveness of this method based on the following aspects. First,
the mathematical model of the method is deduced and the principles of the method are described.
Second, the implementation steps of the method are introduced and error analysis is carried out. Next,
World Electric Vehicle Journal 2020, 11, 71 3 of 17

the rotor polarity is judged. Finally, the effectiveness of the method is verified and conclusions are
drawn through experiment.

2. The Principles of Rotor Position Detection

2.1. Mathematical Model of Permanent Magnet Synchronous Motor

Due to the fact that the mathematical model of a permanent magnet synchronous motor (PMSM)
has the characteristics of multi-variability, strong coupling and nonlinearity, it is difficult to establish
an accurate mathematical model for a permanent magnet synchronous motor. In order to simplify
the mathematical model, the following assumptions are made: (1) neglecting the saturation of the
magnetic circuit of the motor, the magnetic circuit is considered linear; (2) the hysteresis and eddy
current losses of the motor are neglected; (3) the magnetic field of the permanent magnet of the rotor
distributes sinusoidally in the air gap, and the back electromotive force of the motor is a symmetrical
three-phase sinusoidal wave.

The PMSM schematic diagram is shown in Figure 1. Based on the above assumptions, the established
model of the motor in synchronous rotation in a d-q axis system is as follows.

 

Figure 1. Schematic diagram of permanent magnet synchronous motor (PMSM).

The flux equation can be expressed as

Ya Ig O || ta We
— 1
| Wq 0 Lg fl tq r 0 )
where wq and tq are the flux in the d and q axes, respectively; Lq and Lg are inductance in the d and

q axes, respectively; y¢ is the flux of the permanent magnet.
The voltage equation can be derived as

u 1 — d
pia L=ML a fed ve Pa sa | ®
Ug Ig Wq dt| Wq
where ug and ug are the voltage in the d and q axes, respectively; Rg is stator resistance; ig and ig are

currents in the d and q axes, respectively.
The torque equation of the PMSM can be expressed as

Te = Spl tig + (La ~ La)iaia] (3)

where Te is the electromagnetic torque of the permanent magnet synchronous motor and p is the
number of motor pole pairs. For the interior permanent magnet synchronous motor, there is Lg # Lg.
World Electric Vehicle Journal 2020, 11, 71 4 of 17

2.2. Principle of Initial Position Detection

In the A-B-C coordinate system of the PMSM, the voltage equation of the three-phase winding
can be expressed as

uA 1A Wa
up |=Rs] ip | + at Wp (4)
uc ic We

where Ua, Up and uc are, respectively, the phase voltage of the A-B-C three-phase winding; ia, ig and ic
are the phase current of each phase winding; Wa, Wp and Wc are the flux linkage of each phase winding.
There is

Wa La Lap Lac | ta Wea
vp |=} Lea Lp Lec || iB +] ve (5)
We Ica Lop Le ic Wec

where La, Lg and Lc are, respectively, the self-inductance of the A-B-C three-phase winding; Lxx is
the mutual inductance of each phase winding; Wea, Yep and Yc are the flux of the A-B-C three-phase
winding due to the permanent magnet. There is

Wea cos 9
Wep | = We} cos(O - 27/3) (6)
Wic cos(@ + 27/3)

where @ is the angle between the rotor permanent magnet and the A-axis, which is also the angle
between the d-axis and the «-axis, as shown in Figure 2.

a(A)

Figure 2. Relationship between the reference frames.

The self-inductance and mutual inductance of the stator winding are, respectively, expressed as

La Lo cos 20
Lp |=| Lo |+L2} cos2(@ - 27/3) (7)
Le Lo cos 2(@ + 27/3)
Lap LBA 1 Lo cos 20
Lpc |=| Lop | = 5 Lo | +L] cos2(@—- 7/2) (8)
Loa Lac Lo cos 2(6 + 1/3)

where Lo = (Lq + Lq)/2, Lo = (Lg — La)/2. Due to the saliency of the interior permanent magnet
synchronous motor, there is Lg < Lg.

Taking Equations (6), (7) and (8) into (4) and (5), then through 3/2 transformation, in the «-f-axis,
the stator voltage equation can be gained as

Ua _ lo d Wo —Wp
is |= [al oe | + Wo | )
World Electric Vehicle Journal 2020, 11, 71 5 of 17

where Uq and ug are the voltage of the the « and £ axes, respectively, and Yq and we are the flux
of the « and £ axes, respectively. When the motor is stationary, the angular velocity is zero (w; = 0),
and the voltage equation can be simplified as

=R z 10
| [is [tal os | u)
The equation of flux linkage can be expressed as
Va . | Lo + Locos 20 Losin 20 cos 0
= 11
| be | | Losin20 | 78} Ly—Locos20 |* *| sino (1)

In Equation (10), since the frequency of the injected voltage signal is much larger than the fundamental
frequency, the fundamental component can be ignored and the R, can be ignored. Taking Equation (11)
into (10), it can be gained that

 

 

(12)

 

 

an = [Lo + Lz cos(26)] Sieh + Ly sin(20) “8
Ugh = Lo sin(20) Sach + [Lo — Lz cos(20)| a

2.3. Current Response under the High Frequency

When high-frequency voltage is injected into the x-B-axis, the high-frequency current response
can be obtained to estimate rotor position. Making uap = Ugh = Umcoswpt and taking this into
Equation (12), then high-frequency response current can be calculated as

| igh | in| Lo - V2L> cos(20 — 7/4) x sin wrt (13)

ign | wp(L2 — L2)| Lo ~ V2L2 sin(20 — 2/4)

where Um is the amplitude of the high-frequency voltage and wy, is the angular frequency of the
high-frequency voltage. Equation (13) shows that iq, and igy are sinusoidal functions, that their
amplitudes contain position angle information and that the amplitudes of 7,}, and ig} are regulated by
position angle.

In order to obtain the current amplitudes I, and Ig, the traditional method is to multiply the
values of 7,4 and igh by sinwpft and then get the values of Ix and Ig through a low-pass filter, as shown
in Equation (14).

| lh | _
Ign

where Lpr refers to the low-pass filtering algorithm, and the results correspond to the current response

(14)

 

Lpr (ich sin wpt) | Um | Lo — V2L2 cos(20 — 1/4)
Lpr(ign sin wht) 2wp(Li _ L3) Lo - V2L> sin(20 — 7/4)

amplitudes I, and Ip minus the direct-current(DC) component. The following Equation (15) is obtained
(refer to Appendix A for the detailed derivation process).

Ing | | —cos(20 — 7/4)
| Ig6 |=H — sin(20 — 7/4) | (15)

where k is positive, it can be expressed as

k— V2L> Um

~ a(t 12) _
World Electric Vehicle Journal 2020, 11, 71 6 of 17

3. Current Response to Calculate Rotor Position

3.1. Traditional Method of Angle Extraction

From the above section, after the high-frequency voltage signal is injected into the «-f-axis,
the response current contains the initial rotor position information and 0 can be extracted from it,
as shown in Figure 3. The relation between the high-frequency response current and 0 is obtained by

Equation (15).

  

Uh UBh

 

High frequency
voltage signal

  

 
 
   

1A ,1B ,1C

Extraction
< method Current | LPF la 1p Clark
0<0<m amplitude LIE transform

Figure 3. The extraction of rotor position.

In the Equation (14), I,,g, contains the position information of the rotor. Itis necessary to extract the
high-frequency current component Ig) with a low-pass filter (LPF) or bandpass filter (BPF). However,
the use of the LPF or BPF will affect the accuracy of the estimation. For example, a high-frequency
signal of 500 Hz is extracted by BPF. The type of BPF is a typical second-order bandpass filter and the
cut-off frequency is 500. The phase-frequency characteristic curve of the BPF, designed according to

the above requirements, is shown in Figure 4.

 

90

 

 

10° 400 500 600 800 1000 1200

Figure 4. Phase-frequency characteristic curve of bandpass filter (BPF).

From the phase-frequency characteristic curve, it can be seen that a high-frequency signal passing
through the BPF produces a phase shift of about 2° at 500 Hz. This phase shift also changes as the
order of the filter, the cut-off frequency, the passband bandwidth and the frequency of the injected
high-frequency signal change. Therefore, the use of a bandpass filter causes a phase shift in the signal
and a bias in the estimated angle, which is one of the main problems to be solved below.

3.2. Proposed Angle Extraction Method

As can be seen from the above section, after injecting the high-frequency voltage signal into
the x-B-axis we can get the response current, and the amplitudes of the response current, I, and Ip,
contain the information of the rotor position angle 8. The traditional method uses a low-pass filter
to obtain the response current amplitudes I, and Ig, while the low-pass filter will cause a delay in
the phase angle and cause errors. These errors also need a corresponding compensation algorithm,
World Electric Vehicle Journal 2020, 11, 71 7 of 17

which increases the calculation amount of the system. Therefore, in order to reduce the errors caused
by the use of the filter, the method of peak sampling is used; when sinwpft = 1, the values of ig, and
igh are equal to 1, and Ig, and the current amplitudes of I, and Ig are obtained from Equation (17).
This method does not need to use a low-pass filter and avoids the generation of phase delay.

I iax(wht =2+2nn

Um | Lo — V2L2 cos(20 — 11/4)
Ig |

ig (wht =$+2nr) | - 2wp»(L? _ 13) Lo — V2L2 sin(20 — 11/4)

After I, and Ig are obtained, the DC component is subtracted, and a component that is only
related to the position angle 0 can be obtained from Equation (15). The system block diagram is shown
in Figure 5.

  
     
  
   

       
 

High frequ en cy Uah Uph

voltage signal

minus the DC sin wht =1

la, Ib ,Ic
component

Figure 5. The extraction of rotor position.

According to Equation (15), the relationship between high-frequency response current and @ is
shown in Figure 6.

Tao/k Iso/k

   
     

|
-1t -37/4 -n/2 -n/4 7/4 mn/2 3n/4 Tl

Figure 6. Relationship between the amplitude of high-frequency current and 0.

From Equation (15) and Figure 6, @ can be estimated through the following formula:
0 = |-arcsin (Igo /k) + 7/4 /2 (18)

According to the size of I,4g and Igg, the interval of 0 can be determined, and the formula can be
used to estimate @ by a look-up table method. For example, @ can be estimated from the zero interval
in Figure 5.

However, there are some inadequacies in the method of estimating @ according to the
trigonometric function: since the k contains Um and wy, the position angle estimation will be affected
by these parameters. If the motor parameters are not accurate, then the calculated initial angle will
also have errors. By Equation (15), Ig9/I~9 = -tan(20-n/4), and there is 0 = [7+arctan(Ig9/I.x9)+7/4]/2.
By using the arctan, the influence caused by the change of k value will be reduced, and the calculation
of 0 will be more accurate. At the same time, when Ig9/Io is infinitely large in a special position,
it needs to be linearized, solved by the following linearization method and without k.
World Electric Vehicle Journal 2020, 11, 71 8 of 17

Figure 7 is obtained by inversion of [4g and Igg in Figure 6. From Figure 7, the relationship between
the magnitude of the current response amplitude and the interval of @ is given by

Ix-9 > Ig > xo, 0<@0<7/4

Ig-9 > Ix > Iga, Tt/4<O0<7/2
Ix9 >Ip6 > lx-o, Tt/2<0<3n/4
Ig6 >Ixe > Ip-ea, 3m/4<0<7

(19)

where I,-9 and Ig-9 are, respectively, the inverse of I,g and Igg, as shown in Figure 7. The case of
m™<O<27 is same as that of 0<0<7, and the next section introduces the determination of the two cases.
First, the interval of 0 is determined by Equation (19), and then @ is calculated according to the
arctan value. When the value of Ig9/I,,@ between 0 and 7 is infinitely large, that is, [x9 is zero, then the
corresponding 0 has two values, 37/8 and 77/8. Using the linearized formula, we can calculate the
angle around the two values within 1 electrical angle, and the other values can be calculated by the
inverse tangent method.

0= |x + arctan(Igo/Ixo) + ¥|/2, (Iy—@ > Igo > IQ) or (Ig-¢ > Ine > Ip) (20)

0= Jarctan(Ig9/Iao) + %|/2, (In6 > Ig@ > Ix-@) or (Ige >Ixe@> Ip-@)

In the formula, the value of arctangent is taken between (—7/2, 77/2), and the value of 0 in the
formula is within an electric angle of 37/8 and 77/8, which is calculated according to the following
linearization formula.

 

_ Ip-e~la-o Tl T 37 7 37 TT
O= Trolg X Eta B~ T90<9< 3 + TE0 1)
— pete) ym 38m Im ok eg e ky
_ Ige—lg-0 4 47 8 180 8 180
lao loo = I[p-o Igoe

       

-~ -37/4 -7/2 -7/4 7/4 m/2 3n/4 T

Figure 7. Amplitude of high-frequency current and its reverse.
The linearized calculation method can calculate the error angle, and this can be calculated as
Equation (22).

AQ = 9- SO =X 22
Ig-o—Ipo 4 4 (22)

We take the linearization formula near 37/8 as an example, where 0 is the actual angle of the motor,
and Equations (22) and (15) are combined to get the following formula

AO = O- “4 sin(2@)—cos(20) 4 (23)

When 6 = 37/8, it is taken into the above formula, then the calculation error is less than 0.68
electric angles. This shows that the position angle obtained by the linear calculation method has
World Electric Vehicle Journal 2020, 11, 71 9 of 17

minimal error and the effect of the error on the start-up of IPMSM can be ignored. At the same time,
the error is produced only on small interval of 0 in Equation (21), and has no effect on the other positions.

3.3. Angle Error Analysis

When the rotor position is at a special angle, the switching error analysis for the arctangent method
and linear formula method is as follows.

According to Section 3.1 and Equations (20) and (21), when the initial position of the motor
is near a special angle, for example, 37/8 and 77/8, the switching between Equations (20) and (21)
is required. When arctan (Ig9/I@) is less than 89° (electrical angle), the position angle is calculated
by Equation (20). When arctan ([g6/Ix@) is greater than 89° (electrical angle) and less than 91°
(electrical angle), the position angle is calculated by Equation (21). When the formula is switched,
the position angle will produce an error. For example, when @ is 37/8, the switching errors of Equations
(20) and (21) can be expressed by Equation (23).

A@ = arctan(ipo/Ta) + ]/2~ (Po? x F (24)

According to Equation (24), the angle error of formula switching is 0.1° (electrical angle), and the

error of the above linear Equation (21) has been calculated before, so when Equations (20) and (21)

are switched, the influence of angle calculation can be ignored. When @ is 37/8, the simulation diagram

of angle error is shown in Figure 8. It can be seen from the figure that the error brought by formula

switching is less than 0.1° (electrical angle), which is not much different from the theoretical calculation.
This shows that the influence of angle error brought by formula switching can be ignored.

0.4

angle error (°)
!
© ©
Nu = No

oS

i
oO
XQ
CO
oD

89 90 91 92 9
angle (°)

Figure 8. Angle error.

The influence of Um is analyzed as follows.

As mentioned before, in the traditional method, arcsin (Ig/k) is used to calculate 6 in Equation (15).
It can be seen that the Equation has coefficient k, and k contains physical quantities such as Un.
The high-frequency voltage contains high-order harmonic components, which will bring errors to the
calculation results. According to Equation (16), we have

V2w»(L? _- L3\Ip Q 95

arcsin(I Be/ k) = ssi

Based on the theoretical analysis of the influence of voltage Um, taking the 20 V high-frequency
voltage as an example, the angle is calculated by using the arcsin formula and the formula is
0 = [- arcsin (Ig 9/k)+7/4]/2. When 6 = 7/4, in combination with Equation (15), arcsin(—0.707) can be
calculated. Then combining Equation (24), arcsin(—0.707)=arcsin(—14.14/20). The voltage contains
high-order harmonics. Taking the third harmonic as an example, the amplitude of the third harmonic
World Electric Vehicle Journal 2020, 11, 71 10 of 17

is Um3 = 20/3 V = 6.67 V. The sum of Um and U3 is 26.67 V. Finally, the actual voltage injected into the
a-f-axis will become 26.67 V, so value of arcsin will become arcsin(—14.14/26.67). After calculation,
there is a 6.5° (electrical angle) deviation between @ and 7/4, which has a great influence.

4. Polarity Judgment

It can be seen from the above section that when extracting the rotor position information from the
high-frequency current response signal, due to the symmetry of the rotor salient pole, only 0 to 7 can be
estimated, and the actual positive direction of the d-axis cannot be determined; that is, the rotor polarity
cannot be determined. Therefore, polarity judgment is needed. The principle of polarity judgment is
that the stator current generates a magnetic field ps, and the rotor permanent magnet generates 15.
When the two magnetic fields are in the same direction, this will have a magnetic aid effect on the
synthetic magnetic field wp of the air gap, as shown in Figure Ya, increasing the magnetic saturation
degree of the stator core, and entering the saturation area, as shown in Figure 9c. As the magnetic
resistance increases, the winding inductance will decrease, and the winding current and inductance
increase. In contrast, the winding current will increase; when wp, and 1; are in opposite directions,
demagnetization will occur, as shown in Figure 9b, the magnetic saturation of the stator core will
weaken and return to the linear area, as shown in Figure 9d, the magnetoresistance will decrease,
the magnetoresistance inductance will increase, and the winding current will decrease.

 

    

A p-Ainj(- UL)

Figure 9. (a,b) represent the distribution of the air gap magnetic field; (c,d) represent the principle of
rotor pole polarity.

The method steps of polarity judgment are as follows.

(1) A position angle 0 has been calculated in the previous section, and a constant voltage Uy, has been
injected along the angle of 0. The d-axis will generate a response current in this period of time,
and reach the peak value. Remember the current value is ig 9, and its absolute value is |ig 9].

(2) Make Uy =0, and reduce the d-axis current to zero, so as to avoid affecting the following steps.

(3) Inject the voltage Uz, of the same amplitude and time along the direction of 0+71, record the peak
value of d-axis response current as ig 9 +, and record the absolute value aslig 9 + xl.

(4) Compare lig 9] and |ig 6 + xl, if lig, ol > Ida,0 + xl, then prove that 0 is the direction of the N-pole and
0 is the actual angle, otherwise, prove that 0 is the direction of the S-pole and 0 + 7ris actual angle.

When the rotor position angles are 6 and @ + 7, a voltage with amplitude Uj, is injected into

the d-axis i '
ad rT; 9 |i uL(t i
Pt |=| 5 2 | ON) eR | (26)
dt La q

 
World Electric Vehicle Journal 2020, 11, 71 11 of 17

where u(t) is the step variable with time and its maximum value is Uy. Since Rg is very small, it is
not included, and Equation (26) can be reduced to

dig ur(t)
dt — La

 

(27)

Equation (26) shows that when the step process is over, ur (f) is equal to Uy, and there is an inverse
relationship between the maximum values of ig and Lg. In this way, the amplitude of the current
response is obtained by injecting the high-frequency voltage into the d-axis, then recording the d-axis
current amplitudes, |ig 9| and |ig 947|, when the position angles are 0 and 0+71 respectively. It can be
gained that
lno+n

; (28)
lwe+n

0, liael >

0+, ligel <

 

 

The system diagram of polarity judgment is shown in Figure 10.

ud=uL

 

Figure 10. Relationship of stator magnetic potential and flux.

5. Experimental Results

In this study, the theoretical correctness of the rotor initial position detection was verified
by experiment. An experimental platform for detecting initial rotor position of permanent magnet
synchronous motor was set up, as shown in Figure 11. In the experimental system, an interior
permanent magnet synchronous motor with a rated power of 20 kW was selected as the research
object and the rotor had a salient pole structure. The parameters of the motor are shown in Table 1.
The core of the control system was a TMS320F28335, the main circuit was a voltage type three-phase
inverter and the switching frequency was 10 kHz. The amplitude of high-frequency voltage injected
into permanent magnet synchronous motor was 20 V, and the frequency was 500 Hz.

»

DN oaco ae

’
.
.
.
.
LZ
5
.
.
i.

 

> ae

Figure 11. The experimental system.
World Electric Vehicle Journal 2020, 11, 71 12 of 17

Table 1. The simulation parameters of the PMSM.

 

Un/V_ Pn/kW Ty/N-m n/r/min J/kg-m? Lg/mH L,/mH ~~ P R/Q = y,/Wb
300 20 64 3000 =: 0.0033 0.2 0.5 4 0.01023 0.071

Figure 12a shows the actual and estimated positions of the rotor when the actual rotor angle
is 88.7°. In the figure, 0.) is the true rotor position obtained by the resolver, 0.) is the angle obtained
by the improved algorithm, ig is the current response when the positive direction injection and the
reverse direction injection voltage are constant when the polarity is judged, and Ajg is the difference in

the current response.

(16. 00ms/div)

_
a)

8 [0.8rad/div]

 

(b)

 
 

(c) (d)

Figure 12. When 0 = 88.7°: (a) angle comparison and d-axis current experimental waveforms;
(b) amplified waveform of 1 area from Figure 12a; (c) amplified waveform of 2 area from Figure 12a;

(d) amplified waveform of 3 area from Figure 12a.

In Figure 12b, the calculation of the position angle takes about 8 ms. In Figure 12c, When the
polarity is judged, the positive value of Aig indicates that the current response during the d-axis forward
voltage injection is larger than that in the negative injection, indicating |ig,o|>lig,o + xl; therefore, it can
be judged that the rotor position is at the N-pole, 0 = 0.q). Figure 12d shows the current waveform of
iq When injecting the high-frequency signal.

As shown in Figure 13a, the actual position of the rotor was 307.33°. The rotor position is calculated
after the polarity is determined. As shown in Figure 13b, the calculation of the position angle takes
about 8 ms.

As can be seen from Figure 13a, the actual position of the rotor was 129.485° and the rotor position
calculated before the polarity judgment is different from the actual position angle by 7. In Figure 13a,
when the polarity is judged, Aig is negative, indicating that the current response when the d-axis
forward voltage is injected is smaller than that of the negative injection, which is |ig,6|<|iq,e+7|; therefore,
it can be judged that the rotor position is at the S-pole, 0 = 0.4; + 7. Figure 13d shows the current
waveform of iq when injecting a high-frequency signal.
World Electric Vehicle Journal 2020, 11, 71 13 of 17

(16. 0Oms/div]

ki rity
\ judgment

0 [Srad/div]

 

5rad/div]

6 [2.8

 

(c) (d)

Figure 13. When 0 = 307.33°: (a) angle comparison and d-axis current experimental waveforms;
(b) amplified waveform of 1 area from Figure 12a; (c) amplified waveform of 2 area from Figure 12a;
(d) amplified waveform of 3 area from Figure 12a.

Figure 14a shows the high-frequency current response waveform when @ = 88.7°. Figure 14a shows
the ix, ig instantaneous values and the amplitudes I,, Ig containing the direct current component.
When the rotor position is less than 90°, 7, is asymmetrical due to the mechanical asymmetry of the motor.
In Figure 14, the current amplitude obtained by the improved method is very accurate. The direct
current component is calculated to be 25.25A, and after the direct current component is subtracted,
Ix9 = —9.63A, Ig9 = 9.135A and the interval in which the current is located, that is, the interval
Ix-e>Ig0>1«9, and 0 = 90.765° can be obtained according to Equation (19). The error is mainly caused
by the inaccuracy of current sampling. During the operation of the motor, the inductance will reverse,
which leads to the difference between the current value and the theoretical value. This includes the
fact that the DC component fluctuations ripple at a relatively accurate value in each experiment,
which leads to errors in the values of I,4g and Igg9 because the motor operates at zero speed and
no load, so this the error will be very small. Comparing the result estimated by the formula with the
actual result, it can be concluded that the error of position estimation is 2.07°.

i[15.625.5A/div]
i[15.625A/div]

  

(a) (b)
Figure 14. High-frequency response current: (a) 0 = 88.7°; (b) @ = 307.33°.

Figure 14b shows the high-frequency current response waveform when @ = 307.33°.
After subtracting the direct current component, I,9 = —9.625A, Igo = —6.49A, it can be judged
that the current is in the interval, where I,.9 > Igo > Io, and 0 = 129.485° can be obtained according
to Equation (19). Since 0 can only calculate the value within 7, as shown in Figure 13d, the polarity can
be judged by polarity judgment. The position angle should be added to 7, and the estimated position
angle is 309.485°. Compared with the actual position, the position estimation error is 2.15°.
World Electric Vehicle Journal 2020, 11, 71 14 of 17

Figure 15 shows the comparison between the estimated value and the actual value of the
rotor position. By changing the actual initial position of the motor, the actual initial position of the
motor is increased from 0 rad to 27 rad at about every 0.55 rad interval. Compared with the calculated
initial position of the motor, Figure 15 is obtained. It can be seen from the figure that the maximum
error is within 5°, the average error is approximately 2.7° and the detection error of the rotor position
is relatively small. It has little effect on the start-up of the PMSM.

Estimate position
angle

Actual position
angle

Angle and error

angle error

 

7/2 TT 37/2 2m
Actual position angle
(rad)

Figure 15. Comparison between actual angle and estimated angle.

Although the accuracy of the initial position angle calculated by the traditional filter method is
not different from that obtained by the proposed method, when the motor rotates, the method using
the filter has a significant angle delay. This paper does not use the filter, so there is no angle delay.
The experimental results are shown in Figure 16.

Estimate position Actual position

  

2 angle 2 angle |
on hho cf) ce ceebe sees see she cone cen ode
x <S
<= a
c 3 LL cet at = 4 out
ge gé nl
= . = oe ebe Hee ete eee eee ate eee wae we wees
2 Actual position 2 So a
angle | Estimate position
— | eae
(a) (b)

Figure 16. Angle comparison waveform after rotation: (a) traditional method (using filters); (b) method

proposed in this paper.

From the above experimental results, it can be seen that the difference between the estimation
of the rotor position detection value and the actual value is also small. The causes of the error are
mainly the current sampling error, asymmetry of the motor structure, external disturbance of the
system structure and current response error caused by different saturation degrees of the rotor in
different positions. The current response has been averaged over several cycles to reduce the angular
error of the rotor. In subsequent research, the number of periods of calculation can be increased to
reduce angle error.

6. Conclusions

A rotor position detection method for a permanent magnet synchronous motor (PMSM) based on
high-frequency voltage signal injection has been proposed in this paper. The rotating high-frequency
World Electric Vehicle Journal 2020, 11, 71 15 of 17

voltage signal is injected into the stator winding. According to the relation between the amplitude of
high-frequency current response and rotor position angle, the rotor position information is obtained
using inverse tangent and linear formulae, then the polarity of the rotor is distinguished from the
variation of the inductance.

This method is simple and easy to implement, does not depend on parameters and does not
need to use a low-pass filter. It has good application value and can be used in engineering practices.
This paper is mainly applied to the IPMSM. The main mathematical model is also for the IPMSM and
has not been extended to the surface permanent magnet synchronous motor (GPMSM), which is a
limitation of this paper. Later, the model will be analyzed and verified for the surface mounted motor.
In addition, the high-frequency sinusoidal signal injection method adopted in this paper, which is
limited in frequency, will affect the dynamic response performance of the system, and increase the
interference between the fundamental and high-frequency signals.

Author Contributions: Conceptualization, Z.W., X.L. and H.W.; methodology, Z.W. and B.Y.; software, B.Y.
and X.J.; validation, H.W. and X.L.; formal analysis, Z.W. and B.Y.; writing—original draft preparation, B.Y.;
writing—review and editing, Z.W. and L.G. and funding acquisition, Z.W. All authors have read and agreed to the
published version of the manuscript.

Funding: This research was funded by “The Fund Projects of National Natural Science Foundation of
China, grant number 51977150”, “The Young Fund Projects of National Natural Science Foundation of China,
grant number 51907142” and “The Young Fund Projects of Tianjin Natural Science Foundation of China,
grant number 18JCONJC74400”, “The Natural Science Foundation of Tianjin (Grant No.18JCQNJC74200)”,
“The Science & Technology Development Fund of Tianjin Education Commission for Higher Education.
(Grant No. 2018KJ208)”.

Conflicts of Interest: The authors declare no conflict of interest.

Appendix A

It can be seen from Equation (13) that the current is a sine function of wp, and the following
changes for Equation (13).

1 ;
| xh | sins =

Um | Lo — V2L2 cos(20 — 1/4) | xsi’ wont (At)
IBh )

2 2 — 1 —
wy(L2 — L2 Lo — V2L2 sin(20 — 17/4)

Make a trigonometric change to Equation (A1) to get the following formula.

| igh | xsinan _ Um | Lo — V2L2 cos(20 — 1/4) | 1 — cos 2wyt (A2)
iph wn(L? _ 12) Lo — V2L2 sin(20 — 7/4) 2
Expand Equation (A2) into two items, which are
| xh |xsinsoy _ Um | Lo - V2L9 cos(20 — 1/4) |x
igh wn (L5-L3)| Lo — V2L2 sin(20-—1/4) |° 7 (A3)

_ Um Lo - V2L» cos(26 — 7/4) y £98 2wyt
wn (L§-L3)| Lo — V2L2 sin(20 — 1/4)

It can be seen from Equation (A3) that the DC component and high-frequency component
are included. The DC component is not only the I, and Ig, but the high-frequency component can also
be filtered out through a low-pass filter to obtain DC components I, and Ig, as follows

| lh | _
Ign

(A4)

 

Lpr(ich sinwpt) | Um | Lo — V2L2 cos(20 — 1/4) |
Lpr(ign sin wnt) 2wp(L? _ 13) Lo - V2L> sin(20 — 7/4)
World Electric Vehicle Journal 2020, 11, 71 16 of 17

Expand the bracket in Equation (A4)

| lh | _
Ign

It can be seen from (A5) that the right-hand side of the equals sign contains the DC component and

(AS)

 

Lpr(igh Sin Wpft) _ LoUm Um | V2Ly cos(20 — 11/4)
Lp(ign sin wnt) 2w»(L? _ 13) 2w»(L? _ 13) V2L> sin(20 — 1/4)

the rotor position information. It is necessary to subtract the DC component to obtain the component
related only to the rotor position information.
Ix V2L27Um [ —cos(20— 71/4)
| ~ 2_72)\| —sin(20-—7/4) (A6)
po | 2wp,(L - 12)

References

1. Yu, L.; Zhang, Y.; Huang, W. Accurate and Efficient Torque Control of an Interior Permanent Magnet
Synchronous Motor in Electric Vehicles Based on Hall-Effect Sensors. Energies 2017, 10, 410. [CrossRef]

2. Wu, T.; Luo, D.; Huang, S.; Wu, X.; Liu, K.; Lu, K.; Peng, X. A Fast Estimation of Initial Rotor Position for
Low-Speed Free-Running IPMSM. IEEE Trans. Power Electron. 2020, 35, 7664—7673. [CrossRef]

3. Wang, J.; Huang, S.; Guo, C.; Feng, Y. Research on the Axial Force of Conical-Rotor Permanent Magnet
Synchronous Motors with Turbines. Energies 2018, 11, 2532. [CrossRef]

4. Sun, W.; Shen, J.X.; Jin, M.J.; Hao, H. A robust magnetic polarity self-sensing method for start up of PM
synchronous machine in fanlike system. IEEE Trans. Ind. Appl. 2017, 53, 2169-2177. [CrossRef]

5.  Wu,X.; Feng, Y.; Liu, X.; Huang, S.; Yuan, X.; Gao, J.; Zheng, J. Initial Rotor Position Detection for Sensorless
Interior PMSM With Square-Wave Voltage Injection. IEEE Trans. Magn. 2017, 53, 8112104. [CrossRef]

6. Holtz, J. Acquisition of position error and magnet polarity for sensorless control of PM synchronous machines.
IEEE Trans. Ind. Appl. 2008, 44, 1172-1180. [CrossRef]

7.  Raca, D.; Harke, M.C.; Loren, R.D. Robust magnet polarity estimation for initialization of PM synchronous
machines with near-zero saliency. IEEE Trans. Ind. Appl. 2008, 44, 1199-1209. [CrossRef]

8. Yang, S.C.; Yang, S.M.; Hu, J.H. Robust initial position estimation of permanent magnet machine with low
saliency ratio. IEEE Access 2017, 5, 2685-2695. [CrossRef]

9. Ha, J.I.; Ide, K.; Sawa, T.; Sul, S.K. Sensorless rotor position estimation of an interior permanent-magnet
motor from initial states. IEEE Trans. Ind. Appl. 2003, 39, 761-767.

10. Jung, T.-U.; Jang, J.-H.; Park, C.-S. A Back-EMF Estimation Error Compensation Method for Accurate Rotor
Position Estimation of Surface Mounted Permanent Magnet Synchronous Motors. Energies 2017, 10, 1160.
[CrossRef]

11. Bi,G.; Wang, G.; Zhang, G.; Zhao, N.; Xu, D. Low-Noise Initial Position Detection Method for Sensorless
Permanent Magnet Synchronous Motor Drives. IEEE Trans. Power Electron. 2020, 35, 13333-13344. [CrossRef]

12. Wang, G.; Yang, R.; Li, G.; Yu, Y.; Xu, D. Position sensorless control strategy of IPMSM based on high
frequency signal injection. Trans. China Electrotech. Soc. 2012, 11, 62-68.

13. Bianchi, N.; Fornasiero, E.; Bolognani, S. Effect of stator and rotor saturation on sensorless rotor position
detection. IEEE Trans. Ind. Appl. 2013, 49, 1333-1342. [CrossRef]

14. Li, N.; Dong, L.; You, Y.; Gao, Y.; Liao, X. Initial rotor position estimation of IPMSM based on improved
rotating high frequency signal injection. In Proceedings of the IEEE Conference and Expo Transportation
Electrification Asia-Pacific (ITEC Asia-Pacific), Beijing, China, 31 August-3 September 2014; pp. 1-4.

15. Jin, X.; Ni, R.; Chen, W.; Blaabjerg, F.; Xu, D. High-Frequency Voltage-Injection Methods and Observer Design
for Initial Position Detection of Permanent Magnet Synchronous Machines. IEEE Trans. Power Electron. 2018,
33, 7971-7979. [CrossRef]

16. Liu, Y.; Zhou, B.; Li, S.; Feng, Y. Initial rotor position detection of surface mounted permanent magnet
synchronous motor. Proc. CSEE 2011, 31, 48-54.

17. Wang, W.; Zhang, J.; Cheng, M. A simple initial rotor position identification method for PMSM.
In Proceedings of the International Conference on Electrical Machines and Systems (ICEMS), Pattaya,
Thailand, 25-28 October 2015; pp. 786-789.
World Electric Vehicle Journal 2020, 11, 71 17 of 17

18.

19.

20.

21.

22.

23.

24.

Tian, B.; An, Q.; Sun, L.; Sun, D.; Duan, J. Initial position estimation strategy for a surface permanent magnet
synchronous motor used in hybrid electric vehicles. Front. Inf. Technol. Electron. Eng. 2016, &, 803-814.
[CrossRef]

Liu, B.; Zhou, B.; Wei, J.; Wang, L.; Ni, T. A novel method for polarity detection of nonsalient PMSMs
in initial position estimation. In Proceedings of the IEEE Applied Power Electronics Conference and
Exposition (APEC), Long Beach, CA, USA, 20-24 March 2016; pp. 2754-2758.

Kim, H.; Huh, K.K.; Lorenz, R.D.; Jahns, T.M. A novel method for initial rotor position estimation for IPM
synchronous machine drives. IEEE Trans. Ind. Appl. 2004, 40, 1369-1378. [CrossRef]

Zhang, G.; Wang, G.; Xu, D. An initial position detection method of permanent magnet synchronous motor
based on filter-free square wave signal injection. Trans. China Electrotech. Soc. 2017, 32, 163-168.

Qiu, X.; Wang, W.; Yan, J.; Jiang, J.; Yang, J. Phase-Inductance-Based Position Estimation Method for Interior
Permanent Magnet Synchronous Motors. Energies 2017, 10, 2002. [CrossRef]

Zhang, X.; Li, H.; Yang, S.; Ma, M. Improved Initial Rotor Position Estimation for PMSM Drives Based on HF
Pulsating Voltage Signal Injection. IEEE Trans. Ind. Electron. 2018, 65, 4702-4713. [CrossRef]

Wang, S.; Yang, K.; Chen, K. An Improved Position-Sensorless Control Method at Low Speed for PMSM
Base on High-Frequency Signal Injection into a Rotating Reference Frame. IEEE Access 2019, 7, 86510-86521.
[CrossRef]

Publisher’s Note: MDPI stays neutral with regard to jurisdictional claims in published maps and institutional
affiliations.

@) © 2020 by the authors. Licensee MDPI, Basel, Switzerland. This article is an open access
article distributed under the terms and conditions of the Creative Commons Attribution
Ey

(CC BY) license (http://creativecommons.org/licenses/by/4.0/).
